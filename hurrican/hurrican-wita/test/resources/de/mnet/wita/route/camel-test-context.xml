<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd

           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
           http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

    <context:annotation-config/>

    <!--
    Mockito Mocks : these *must* be defined first, i.e. placed at the top of this spring config.
    -->
    <bean id="routeConfigHelper" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.common.route.helper.RouteConfigHelper"/>
    </bean>

    <bean id="witaIoArchiveOutProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.out.WitaIoArchiveOutProcessor"/>
    </bean>
    <bean id="convertWitaToCdmProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.out.ConvertWitaToCdmProcessor"/>
    </bean>
    <bean id="setStatusTransferredProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.out.SetStatusTransferredProcessor"/>
    </bean>
    <bean id="createSendLogProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.out.CreateSendLogProcessor"/>
    </bean>

    <bean id="convertCdmV1ToWitaFormatProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.in.ConvertCdmV1ToWitaFormatProcessor"/>
    </bean>
    <bean id="convertCdmV2ToWitaFormatProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass"
                         value="de.mnet.wita.route.processor.lineorder.in.ConvertCdmV2ToWitaFormatProcessor"/>
    </bean>

    <bean id="lineOrderIoArchiveInProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.in.WitaIoArchiveInProcessor"/>
    </bean>

    <bean id="storeLineOrderMessageInProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.in.StoreWitaMessageInProcessor"/>
    </bean>

    <bean id="generateErrorMessageProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.common.errorhandling.processor.GenerateErrorMessageProcessor"/>
    </bean>

    <bean id="marshalErrorMessageProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.common.errorhandling.processor.MarshalErrorMessageProcessor"/>
    </bean>

    <bean id="evaluateCdmVersionProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.wita.route.processor.lineorder.out.EvaluateCdmVersionProcessor"/>
    </bean>

    <bean id="hurricanExceptionLogErrorHandler" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.common.exceptions.HurricanExceptionLogErrorHandler"/>
    </bean>

    <bean id="addOptionsAsExchangePropertiesProcessor" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="de.mnet.common.route.ExtractExchangeOptionsProcessor"/>
    </bean>

    <bean id="emsTransactionManager" name="emsTransactionManager" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="org.springframework.transaction.PlatformTransactionManager"/>
    </bean>

    <bean id="dbTransactionManager" name="dbTransactionManager" class="de.mnet.wbci.MocksFactory">
        <constructor-arg name="mockClass" value="org.springframework.transaction.PlatformTransactionManager"/>
    </bean>

    <!--
        Camel context, routes and policies
    -->

    <camelContext id="camelContext" xmlns="http://camel.apache.org/schema/spring" />

    <bean id="lineOrderOutRoute" class="de.mnet.wita.route.LineOrderOutRoute" />

    <bean id="lineOrderInV1Route" class="de.mnet.wita.route.LineOrderInV1Route"/>
    <bean id="lineOrderInV2Route" class="de.mnet.wita.route.LineOrderInV2Route"/>

    <bean id="ems.required" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
        <property name="transactionManager" ref="emsTransactionManager"/>
        <property name="propagationBehaviorName" value="PROPAGATION_REQUIRED"/>
    </bean>

    <bean id="ems.requires_new" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
        <property name="transactionManager" ref="emsTransactionManager"/>
        <property name="propagationBehaviorName" value="PROPAGATION_REQUIRES_NEW"/>
    </bean>

    <bean id="ems.propagation_not_supported" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
        <property name="transactionManager" ref="emsTransactionManager"/>
        <property name="propagationBehaviorName" value="PROPAGATION_NOT_SUPPORTED"/>
    </bean>

    <bean id="db.required" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
        <property name="transactionManager" ref="dbTransactionManager"/>
        <property name="propagationBehaviorName" value="PROPAGATION_REQUIRED"/>
    </bean>

    <bean id="db.requires_new" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
        <property name="transactionManager" ref="dbTransactionManager"/>
        <property name="propagationBehaviorName" value="PROPAGATION_REQUIRES_NEW"/>
    </bean>

</beans>
